{% extends "userbase.html" %}
{% block link %}
    <link rel="stylesheet" href="/static/css/omretnews/postarti.css">
    <script type="text/javascript" src="/static/other/tinymce/js/tinymce/tinymce.min.js"></script>
    <link rel="stylesheet" href="/static/css/counter.css">
    <script src="/static/js/counter.js"></script>
    <script src="/static/other/qiniu/plupload/moxie.min.js"></script>
    <script src="/static/other/qiniu/plupload/plupload.min.js"></script>
    <script src="/static/other/qiniu/dist/qiniu.min.js"></script>
    <script src="/static/js/omretnews/postarti.js"></script>
    <!--
    <script src="//cdn.tinymce.com/4/tinymce.min.js"></script>
    -->
    <script>
        tinymce.init({
            selector: '#omrettinymce',
            theme: 'modern',
            elementpath: false,
            menubar: false,
            resize: false,
            statusbar: false,
            height: 300,
            language: 'zh_CN',
            plugins: 'link image preview fullscreen textcolor autolink insertimage',
            toolbar1: 'bold italic underline | alignleft aligncenter alignright | forecolor backcolor | bullist numlist | link insertimage | preview fullscreen',
            //toolbar2:'link image | preview fullscreen | insertdatetime emoticons',
            file_browser_callback: function (field_name, url, type, win) {
                if (type == 'image')
                    $('#imagepicker_form input').click();
            }
        });
    </script>
{% endblock %}

{% block title %}
    Post Artical
{% endblock %}

{% block body %}
    <!-- bootstrap modal part -->
    <div class="modal fade active" id="insertimageModal" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width: 300px;margin-top: 120px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close"
                            data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        插入图片
                    </h4>
                </div>
                <div class="modal-body">
                    <p><span id="uploadimage_text" class="modaltext">上传图片</span>
                        <small>或</small>
                        <span id="referimage_text" class="modaltext">引用外部网站图片</span></p>
                    <div id="uploadimage_content">
                        <button type="button" class="btn btn-primary" id="choosefile_button">选择文件</button>
                        <div id="uploadinfotext" style="padding-top: 8px;padding-left: 8px">图片小于2M</div>
                        <!--
                        <input id="imagepicker" name="image" type="file" accept="image/*"
                                style="width: 0px;height: 0px;display: none">
                        -->
                    </div>
                    <div id="referimage_content">
                        <label class="control-label">输入图片链接：</label>

                        <div class="form-inline">
                            <input type="text" class="form-control" id="referimage_input">
                            <button class="btn btn-primary" id="referimage_sure">确定</button>
                        </div>
                    </div>
                </div>
                <!--
                <div class="modal-footer">
                     <button type="button" class="btn btn-default"
                             data-dismiss="modal">取消
                     </button>
                     -->
                <!--<button type="button" class="btn btn-primary">
                    提交更改
                </button>-->
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal -->
    </div>
    <div>
        <div id="container">
            <div id="content-part">
                <form method="post">
                    {% csrf_token %}
                    <label class="control-label">标题</label>

                    <div class="form-group">
                        {{ artiform.title }}
                    </div>
                    <label class="control-label">主题</label>

                    <div class="form-group">
                        {{ artiform.topic }}
                    </div>
                    <label class="control-label">文章主体</label>
                    <!--
                    <textarea id="omrettinymce">
                    </textarea>
                    -->
                    {{ artiform.content }}

                    <button id="postarti-button" type="submit" class="btn btn-primary">发表</button>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block body_script %}
    <script>
        //---modal part-----
        var uploadpart = function () {
            $("#uploadimage_content").show();
            $("#referimage_content").hide();
        }
        var referpart = function () {
            $("#uploadimage_content").hide();
            $("#referimage_content").show();
        }
        var resetInsertImage = function () {
            $("#insertimageModal").modal('hide');

            $("#referimage_input").val("");
            uploadpart();
        }
        $("#uploadimage_text").click(function () {
            uploadpart()
        });

        $("#referimage_text").click(function () {
            referpart()
        });

        $("#referimage_sure").click(function () {
            var imageurl = $("#referimage_input").val();
            insertimage(imageurl)
            resetInsertImage();
        });

       /* $("#choosefile_button").click(function () {
            return $("#imagepicker").click();
        });*/

        /*$("#imagepicker").change(function(){

            imageupload();
        });*/
        //-------------------

        //counter
        $('body').find('#titleform').bind("keydown", function () {
            wordTip($(this), 30, -80, 22)
        });


    </script>
{% endblock %}
